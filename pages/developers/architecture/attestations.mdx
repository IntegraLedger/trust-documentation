# Attestation Layer

## Overview

The attestation layer provides verifiable claims without revealing underlying data. Built on Ethereum Attestation Service (EAS), it enables privacy-preserving credentials and reputation.

## Attestation Types

### 1. Root Identity Attestations

Verify core identity without exposing PII.

**Individual Identity:**
- Name verification (optional disclosure)
- Professional credentials
- Educational qualifications
- Government ID verification

**Organizational Identity:**
- Business registration
- Tax ID verification
- Operating licenses
- Authorized signers

**Example:**
```typescript
// Attest to verified identity
const attestation = await eas.attest({
  schema: IDENTITY_VERIFICATION_SCHEMA,
  data: {
    recipient: userAddress,
    verificationType: "government-id",
    verificationLevel: "high",
    // Actual ID details NOT included
  }
});
```

### 2. Access Permission Attestations

Grant access without on-chain PII storage.

**Benefits:**
- Avoids storing sensitive data on-chain
- Prevents correlation attacks
- Enables revocable access
- Privacy-preserving authorization

**Example:**
```typescript
// Attest to document access rights
const attestation = await eas.attest({
  schema: ACCESS_PERMISSION_SCHEMA,
  data: {
    recipient: userAddress,
    documentHash: documentHash,
    accessLevel: "read",
    expiresAt: Date.now() + 30 * 24 * 60 * 60 * 1000 // 30 days
  }
});

// Verify access
const hasAccess = await verifyAttestation(userAddress, documentHash);
```

### 3. Social Trust Graph Attestations

Prove contract participation without revealing details.

**Concept:** Contracts as "credentials" with EAS attestation as zkProof.

**Benefits:**
- Prove you worked on a project without revealing scope
- Prove you have a credential without showing the credential
- Build reputation through attestations
- Network effects of verified relationships

**Example:**
```typescript
// Client attests to contractor's work (private details)
const attestation = await eas.attest({
  schema: PROJECT_COMPLETION_SCHEMA,
  data: encryptData({
    recipient: contractorAddress,
    projectType: "smart-contract-audit",
    rating: 5,
    // Details like code, findings, payment ENCRYPTED
  }, contractorPublicKey)
});

// Contractor can prove: "I completed a smart-contract-audit with 5-star rating"
// Contractor CANNOT reveal: Specific code, client identity (unless consented), payment
```

## Privacy-Preserving Proofs

### Zero-Knowledge Attestations

Prove you have a credential without revealing it:

```typescript
// Prove employment without details
const proof = await generateZKProof({
  attestation: employmentAttestation,
  reveal: ["employer", "duration"],
  hide: ["salary", "title", "performance"]
});

// Verifier sees: "Employed at Company X for 2 years"
// Verifier doesn't see: Salary, title, reviews, termination reason
```

### Selective Disclosure

Control what information is shared:

```typescript
const disclosure = {
  // Revealed
  hasCredential: true,
  credentialType: "professional-license",
  issuer: "licensing-board.eth",
  issuedDate: "2022-01-01",

  // Hidden
  licenseNumber: HIDDEN,
  personalInfo: HIDDEN,
  examination Scores: HIDDEN
};
```

### Unlinkability

Prevent correlation across contexts:

```typescript
// Use different pseudonyms for different roles
const workIdentity = deriveIdentity(rootKey, "work");
const socialIdentity = deriveIdentity(rootKey, "social");

// Attestations can't be linked unless user chooses to reveal
```

## Building Trust Networks

### Contract Completion Attestations

```typescript
// After project completion
await eas.attest({
  schema: CONTRACT_COMPLETION_SCHEMA,
  data: {
    recipient: serviceProvider,
    contractHash: documentHash,
    completionQuality: "excellent",
    deliveredOnTime: true,
    wouldWorkAgainWith: true
  }
});
```

### Reputation Aggregation

```typescript
// Query all attestations for a user
const attestations = await eas.getAttestationsForRecipient(userAddress);

// Calculate trust score
const trustScore = calculateTrustScore(attestations);
// Factors: number of attestations, variety of attesters, recency, ratings
```

### Network Effects

As more attestations accumulate:
- Trust score increases
- Access to larger contracts
- Lower escrow requirements
- Premium positioning in marketplace

## Technical Implementation

### Creating Attestations

```typescript
import { EAS, SchemaEncoder } from '@ethereum-attestation-service/eas-sdk';

const eas = new EAS(EAS_CONTRACT_ADDRESS);
eas.connect(signer);

const schemaEncoder = new SchemaEncoder(
  "address recipient,string credentialType,uint8 rating"
);

const encodedData = schemaEncoder.encodeData([
  { name: "recipient", value: recipientAddress, type: "address" },
  { name: "credentialType", value: "employment", type: "string" },
  { name: "rating", value: 5, type: "uint8" }
]);

const tx = await eas.attest({
  schema: SCHEMA_UID,
  data: {
    recipient: recipientAddress,
    expirationTime: 0,
    revocable: true,
    data: encodedData
  }
});
```

### Verifying Attestations

```typescript
// Get attestation
const attestation = await eas.getAttestation(attestationUID);

// Check validity
if (!attestation.revoked && 
    (attestation.expirationTime === 0 || attestation.expirationTime > Date.now())) {
  // Attestation is valid
  const data = decodeAttestationData(attestation.data);
}
```

### Revoking Attestations

```typescript
// Revoke if credential is no longer valid
await eas.revoke({
  schema: SCHEMA_UID,
  data: { uid: attestationUID }
});
```

## Privacy Best Practices

1. **Encrypt Sensitive Data** - Use public key encryption for attestation data
2. **Minimize On-Chain Data** - Store only commitments, not raw data
3. **Enable Revocation** - Support credential expiration and revocation
4. **Use Selective Disclosure** - Reveal only necessary information
5. **Prevent Correlation** - Use different identities for different contexts

## Related Topics

- [Identity Principles](./identity)
- [Privacy Guarantees](./privacy)
- [Trust Mechanisms](./trust)
- [IntegraVerifierRegistry Contract](../smart-contracts/contracts/integra-verifier-registry)

## Support

- ðŸ“§ Email: developers@integraledger.com
- ðŸ’¬ Discord: [Join our community](https://discord.gg/integra)
